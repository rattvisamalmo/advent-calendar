<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>R√§ttvisa Malm√∂ ‚Äî Advent Calendar</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=MuseoModerno:wght@300;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#faf8f3;
      --accent:#dd6031;
      --accent-2:#ffea94;
      --dark:#311e10;
      --white:#ffffff;
      --card-radius:14px;
      --shadow:0 20px 60px rgba(17,12,9,0.12);
      font-family:'Poppins', sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(135deg,var(--bg) 0%, var(--accent-2) 100%);font-family:'Poppins',sans-serif;}
    .container{width:100%;max-width:1400px;margin:0 auto;padding:40px 20px;}

    .header{text-align:center;margin-bottom:40px}

    .header h1{
      font-family:'MuseoModerno';
      font-size:3em;
      margin:0 0 10px;
    }

    .header h1 .rattvisa {
      font-family: 'MuseoModerno';
      font-weight: 900;
      color: #dd6031;
    }

    .header h1 .malmo {
      font-family: 'MuseoModerno';
      font-weight: 300;
      color: #311e10;
    }

    .header p{font-size:1.1rem;color:#311e10;margin:0;font-style:italic}

    .calendar-grid{
      display:grid;
      grid-template-columns:repeat(6,1fr);
      gap:20px;
      margin-bottom:30px
    }

    @media(max-width:1024px){.calendar-grid{grid-template-columns:repeat(4,1fr)}}
    @media(max-width:768px){
      .calendar-grid{grid-template-columns:repeat(3,1fr);gap:12px}
    }
    @media(max-width:420px){.calendar-grid{grid-template-columns:repeat(2,1fr);gap:10px}}

    .door-container{perspective:1000px;aspect-ratio:1/1;position:relative}
    .door{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);cursor:pointer;border-radius:12px}
    .door.flipped .door-inner{transform:rotateY(180deg)}
    .door.locked{cursor:not-allowed}
    .door.shake{animation:shake 0.4s}

    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(-6px)}
      50%{transform:translateX(6px)}
      75%{transform:translateX(-6px)}
      100%{transform:translateX(0)}
    }


    .tooltip{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      background:var(--dark);
      color:white;
      padding:8px 10px;
      font-size:0.8rem;
      border-radius:6px;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s;
      white-space:nowrap;
      z-index: 9999;
    }
    .tooltip.show{opacity:1}

    .door-inner{width:100%;height:100%;transform-style:preserve-3d;transition:transform 0.6s cubic-bezier(0.68,-0.55,0.265,1.55)}
    .door-front,.door-back{position:absolute;inset:0;border-radius:12px;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 28px rgba(0,0,0,0.12)}

    .door-front{background:linear-gradient(135deg,var(--accent) 0%, #ff8a5c 100%);border:3px solid var(--dark);}
    .door-number{font-size:2.2rem;font-weight:700;color:var(--white);text-shadow:1px 2px 6px rgba(0,0,0,0.25)}
    .door-sub{font-size:0.8rem;color:var(--white);opacity:0.95;margin-top:6px}
    .door-back{background:var(--white);transform:rotateY(180deg);padding:14px;border:3px solid var(--accent-2);}
    .door-back-content{font-size:0.9rem;color:var(--dark);text-align:center;overflow:hidden}

    .today {
      box-shadow: 0 0 30px 6px #7CFC00, 0 0 60px 12px #32CD32; /* larger pulsating green */
      animation: pulseGlowGreen 2s infinite ease-in-out;
    }

    @keyframes pulseGlowGreen {
      0% { box-shadow: 0 0 15px 3px #7CFC00, 0 0 30px 6px #32CD32; }
      50% { box-shadow: 0 0 30px 6px #32CD32, 0 0 60px 12px #7CFC00; }
      100% { box-shadow: 0 0 15px 3px #7CFC00, 0 0 30px 6px #32CD32; }
    }



    .locked-overlay {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.45); /* frosted white */
      backdrop-filter: blur(4px); /* slight blur */
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none; /* prevent clicks on overlay itself */
    }

    .locked-overlay .lock {
      font-size: 2rem;
      color: var(--dark);
      opacity: 0.85;
      pointer-events: none; /* lock icon doesn‚Äôt catch clicks */
    }


    .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(49,30,16,0.9);z-index:1000;align-items:center;justify-content:center;padding:20px}
    .modal-overlay.active{display:flex}
    @keyframes modalOpen {
      from {
        transform: scale(0.7);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    .modal-overlay.active .modal-content {
      animation: modalOpen 0.35s ease-out forwards;
    }

    .modal-content{background:var(--bg);border-radius:20px;padding:40px;max-width:780px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.3);max-height:90%;overflow-y:auto}

    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:3px solid var(--accent-2)}
    .modal-day{font-size:2rem;color:var(--accent);font-weight:700}
    .close-btn{background:var(--accent);color:var(--white);border:none;width:44px;height:44px;border-radius:50%;font-size:1.4rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .25s}
    .close-btn:hover{background:var(--dark);transform:rotate(90deg)}

    .modal-text{font-size:1.05rem;color:var(--dark);line-height:1.6;margin:18px 0}

    .action-button{background:var(--accent);color:var(--white);border:none;padding:16px 28px;font-size:1.05rem;border-radius:999px;cursor:pointer;transition:all .25s;width:100%;font-weight:700;box-shadow:0 8px 24px rgba(221,96,49,0.22)}
    .action-button:hover{background:var(--dark);transform:translateY(-3px);box-shadow:0 12px 34px rgba(221,96,49,0.28)}

    .toast{position:fixed;left:50%;top:20%;transform:translateX(-50%);background:var(--accent);color:var(--white);padding:14px 22px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.25);z-index:2000}

    @media(max-width:768px){.header h1{font-size:2em}.modal-content{padding:24px}.modal-day{font-size:1.6rem}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><span class="rattvisa">r√§ttvisa</span> <span class="malmo">malm√∂</span></h1>
      <p>Adventskalender ‚Äî 24 dagar av handling f√∂r en etisk upphandlingspolicy</p>
    </div>

    <div class="calendar-grid" id="calendar-grid" aria-live="polite"></div>
  </div>

  <div class="modal-overlay" id="modal-overlay" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header"><div class="modal-day" id="modal-day">Dag 1</div><button class="close-btn" id="close-btn">√ó</button></div>
      <div class="modal-text" id="modal-text"></div>
      <button class="action-button" id="action-button"></button>
    </div>
  </div>

  <script>
    const devMode = true; // override locking if true

    const today = new Date();
    const currentDay = devMode ? 24 : (today.getMonth()===11 ? today.getDate() : 0);

    const calendarData = [
      {title:'Dela initiativet', text:'Dela l√§nken till medborgarinitiativet och be en v√§n r√∂sta.', action:{type:'share', url:'https://malmo.flexite.com/malmo_fp/listview/3GLM/detailsView/33891?lang=sv'}},
      {title:'Skicka ett DM', text:'Skicka ett privat meddelande till en v√§n och be dem st√∂dja kampanjen.', action:{type:'dm'}},
      {title:'Dela en story', text:'Dela kampanjens bild p√• din Instagram Story med en f√∂reslagen text.', action:{type:'share', url:'https://malmo.flexite.com/malmo_fp/listview/3GLM/detailsView/33891?lang=sv'}},
      {title:'L√§mna en kommentar', text:'Skriv en st√∂djande kommentar p√• initiativets sida och beskriv varf√∂r detta √§r viktigt f√∂r Malm√∂.', action:{type:'link', url:'https://malmo.flexite.com/malmo_fp/listview/3GLM/detailsView/33891?lang=sv'}},
      {title:'Maila en politiker', text:'Skicka ett kort mejl till en Malm√∂politiker och be dem st√∂dja en etisk upphandlingspolicy.', action:{type:'mailto', to:'malmo@vansterpartiert.se', subject:'St√∂d f√∂r etisk upphandling i Malm√∂', body:'Hej,%0D%0A%0D%0AJag vill uppmana er att st√∂dja en etisk upphandlingspolicy i Malm√∂ som f√∂rhindrar att skattemedel g√•r till f√∂retag inblandade i grova kr√§nkningar av m√§nskliga r√§ttigheter.%0D%0A%0D%0MV√§nliga h√§lsningar,'}},
      {title:'Dela en faktabild', text:'Dela en faktabild om hur mycket Malm√∂ spenderar och varf√∂r etiska regler beh√∂vs.', action:{type:'share', url:'https://malmo.flexite.com/malmo_fp/listview/3GLM/detailsView/33891?lang=sv'}},
      {title:'Titta p√• video', text:'Titta p√• v√•r 30‚Äì60 sekunder l√•nga f√∂rklaring och l√§mna en kommentar f√∂r att √∂ka r√§ckvidden.', action:{type:'video', url:''}},
      {title:'Kommentera Malm√∂stads sida', text:'L√§mna en artig kommentar p√• Malm√∂ Stads officiella Instagram och be dem anta f√∂rslaget.', action:{type:'link', url:'https://www.instagram.com/malmostad/'}},
      {title:'Affischera', text:'Ladda ner en enkel affisch och s√§tt upp i ditt trapphus eller anslagstavla.', action:{type:'download', url:'https://malmo.flexite.com/malmo_fp/listview/3GLM/detailsView/33891?lang=sv'}},
      {title:'Prata med en v√§n', text:'Ber√§tta om kampanjen f√∂r en v√§n ‚Äî organisera en kort pratstund.', action:{type:'offline'}},
      {title:'Kommentera sista inl√§gget', text:'Skriv en uppmuntrande kommentar p√• v√•rt sista inl√§gg f√∂r att √∂ka r√§ckvidden.', action:{type:'social_comment'}},
      {title:'Skriv ett personligt meddelande', text:'Skicka ett personligt, v√§nligt mejl till en kontakt i politiken med din story.', action:{type:'mailto', to:'malmo@vansterpartiert.se', subject:'Personligt st√∂d f√∂r etisk upphandling', body:'Hej,%0D%0A%0D%0AJag vill kort ber√§tta varf√∂r jag st√∂djer en etisk upphandlingspolicy i Malm√∂: [Skriv din korta anledning h√§r].%0D%0A%0D%0MV√§nliga h√§lsningar,'}},
      {title:'Maila parti', text:'Skicka samma korta mejl till det socialdemokratiska gruppmejlet.', action:{type:'mailto', to:'malmo@socialdemocraterna.se', subject:'St√∂d f√∂r etisk upphandling i Malm√∂', body:'Hej,%0D%0A%0D%0AJag vill uppmana er att st√∂dja en etisk upphandlingspolicy i Malm√∂ som f√∂rhindrar att skattemedel g√•r till f√∂retag inblandade i grova kr√§nkningar av m√§nskliga r√§ttigheter.%0D%0A%0D%0MV√§nliga h√§lsningar,'}},
      {title:'Ring en politiker', text:'Anv√§nd dagens korta manus f√∂r att ringa en lokal politiker ‚Äî 30 sekunder r√§cker.', action:{type:'call', script:'Hej, jag ringer f√∂r att be er st√∂dja en etisk upphandlingspolicy i Malm√∂. Tack.'}},
      {title:'Skriv ditt sk√§l', text:'Dela en kort mening om varf√∂r du st√∂djer etisk upphandling ‚Äî posta den och tagga kampanjen.', action:{type:'ugc'}},
      {title:'Skriv under & dela', text:'Skriv under petitionen eller dela den vidare till v√§nner.', action:{type:'link', url:'https://malmo.flexite.com/malmo_fp/listview/3GLM/detailsView/33891?lang=sv'}},
      {title:'Skicka till partigrupper', text:'Skicka det f√§rdiga mejlet till partigrupperna: malmo@vansterpartiert.se, malmo@socialdemocraterna.se, malmo@liberalerna.se', action:{type:'mailto-multi', to:['malmo@vansterpartiert.se','malmo@socialdemocraterna.se','malmo@liberalerna.se'], subject:'St√∂d f√∂r etisk upphandling i Malm√∂', body:'Hej,%0D%0A%0D%0AJag vill uppmana ert parti att st√∂dja en etisk upphandlingspolicy i Malm√∂.%0D%0A%0D%0MV√§nliga h√§lsningar,'}},
      {title:'Dela i WhatsApp-grupp', text:'Dela detta inl√§gg i en av dina WhatsApp-grupper.', action:{type:'share', url:'https://malmo.flexite.com/malmo_fp/listview/3GLM/detailsView/33891?lang=sv'}},
      {title:'Tagga en influencer', text:'Tagga en lokal influencer f√∂r att sprida kampanjens budskap.', action:{type:'social_tag', text:'@rattvisamalmo'}},
      {title:'Dela v√•r profil', text:'Dela kampanjens profil p√• din story.', action:{type:'share', url:'https://www.instagram.com/rattvisamalmo/'}},
      {title:'Skapa en teckning', text:'G√∂r en handgjord teckning som st√∂djer v√•r kampanj och dela den, gl√∂m inte att tagga oss @rattvisamalmo!', action:{type:'ugc'}},
      {title:'Social unders√∂kning', text:'Skapa en omr√∂stning p√• sociala medier och fr√•ga vem i ditt n√§tverk som har h√∂rt talas om R√§ttvisa Malm√∂. Dela resultaten och tagga kampanjen @rattvisamalmo!', action:{type:'poll'}},
      {title:'L√§mna ett vykort', text:'L√§mna ett kampanjvykort p√• ditt lokala bibliotek, caf√© eller gym.', action:{type:'offline'}},
      {title:'Dela quiz-resultat', text:'Avsluta v√•rt quiz och dela dina resultat! Tagga en v√§n och utmana dem att g√∂ra samma sak!', action:{type:'quiz', url:'https://rattvisamalmo.github.io/advent-calendar/quiz.html'}}
    ];


    const grid = document.getElementById('calendar-grid');
    const modalOverlay = document.getElementById('modal-overlay');
    const modalDay = document.getElementById('modal-day');
    const modalText = document.getElementById('modal-text');
    const actionButton = document.getElementById('action-button');
    const closeBtn = document.getElementById('close-btn');

    function buildMailto(to, subject, body){
      const safeTo = Array.isArray(to) ? to.join(',') : (to||'');
      const parts = [];
      if(subject) parts.push('subject='+encodeURIComponent(subject));
      if(body) parts.push('body='+encodeURIComponent(body));
      return 'mailto:'+safeTo + (parts.length ? ('?'+parts.join('&')) : '');

    }

    function showToast(text){
      const t = document.createElement('div');
      t.className='toast';
      t.textContent=text;
      document.body.appendChild(t);
      setTimeout(()=>{t.style.opacity='0';t.addEventListener('transitionend',()=>t.remove());},1800);
    }

    function tryShare(url){
      if(navigator.share){
        navigator.share({title:'R√§ttvisa Malm√∂',text:'St√∂d detta initiativ',url}).catch(()=>{});
        return true;
      }
      return false;
    }

    // Render calendar
    calendarData.forEach((item, index) =>{
      const container = document.createElement('div');
      container.className='door-container';

      const door = document.createElement('div');
      door.className='door';
      const inner = document.createElement('div');
      inner.className='door-inner';
      door.appendChild(inner);
      door.setAttribute('data-day', (index + 1));

      const front = document.createElement('div'); front.className='door-front';
      front.innerHTML=`<div style='text-align:center'><div class='door-number'>${(index + 1)}</div><div class='door-sub'>${item.title}</div></div>`;
      const back = document.createElement('div'); back.className='door-back';
      back.innerHTML=`<div class='door-back-content'>${item.title}</div>`;

      inner.appendChild(front); inner.appendChild(back);
      container.appendChild(door);

      const isUnlocked = (index + 1) <= currentDay && currentDay > 0;

      if(!isUnlocked){
        door.classList.add('locked');

        // add frosted overlay
        const overlay = document.createElement('div');
        overlay.className = 'locked-overlay';
        overlay.innerHTML = '<span class="lock">üîí</span>';
        door.appendChild(overlay);

        const tooltip = document.createElement('div');
        tooltip.className='tooltip';
        tooltip.textContent='L√•st - √∂ppnas p√• dag '+ (index + 1);
        document.body.appendChild(tooltip); // move tooltip to body

        container.addEventListener('mouseenter',()=>{
          const rect = container.getBoundingClientRect();
          tooltip.style.left = rect.left + rect.width/2 + 'px';
          tooltip.style.top = rect.bottom + 8 + 'px'; // 8px below the card
          tooltip.classList.add('show');
        });

        container.addEventListener('mouseleave',()=>{ tooltip.classList.remove('show'); });
        container.addEventListener('click', ()=>{ door.classList.add('shake'); tooltip.classList.add('show'); setTimeout(()=>{door.classList.remove('shake'); tooltip.classList.remove('show');},2000); });
      } else {
        if((index + 1) === currentDay) door.classList.add('today');
        container.addEventListener('click', ()=>{
          door.classList.add('flipped');
          setTimeout(()=>{
            modalDay.textContent='Dag '+(index + 1);
            modalText.textContent=item.text;
            
            // set action button text
            if(item.action.type === 'mailto' || item.action.type === 'mailto-multi') actionButton.textContent = 'Skicka mejl';
            else if(item.action.type === 'share') actionButton.textContent = 'Dela vidare';
            else if(item.action.type === 'link') actionButton.textContent = '√ñppna sidan';
            else if(item.action.type === 'quiz') actionButton.textContent = 'Starta quiz';
            else if(item.action.type === 'copy') actionButton.textContent = 'Kopiera l√§nk';
            else if(item.action.type === 'download') actionButton.textContent = 'Ladda ner';
            else if(item.action.type === 'call') actionButton.textContent = 'Se manus';
            else if(item.action.type === 'dm') actionButton.textContent = 'Skicka DM';
            else if(item.action.type === 'video') actionButton.textContent = 'Se video';
            else actionButton.textContent = 'G√∂r aktiviteten';

            modalOverlay.dataset.current = (index + 1);
            modalOverlay.classList.add('active');
          },280);
        });
      }

      container.tabIndex=0;
      grid.appendChild(container);
    });

    closeBtn.addEventListener('click', ()=>{ modalOverlay.classList.remove('active'); });
    modalOverlay.addEventListener('click',(e)=>{ if(e.target===modalOverlay) modalOverlay.classList.remove('active'); });

    actionButton.addEventListener('click', ()=>{
      const day = Number(modalOverlay.dataset.current);
      const item = calendarData[day-1];
      if(!item) return;

      switch(item.action.type){
        case 'mailto':
          window.location.href = buildMailto(item.action.to, item.action.subject, item.action.body);
          break;
        case 'mailto-multi':
          window.location.href = buildMailto(item.action.to, item.action.subject, item.action.body);
          break;
        case 'share':
          if(!tryShare(item.action.url)){
            navigator.clipboard.writeText(item.action.url).then(()=>{ showToast('L√§nken kopierad ‚Äî klistra in i din app f√∂r att dela.'); window.open(item.action.url,'_blank'); });
          }
          break;
        case 'link':
          window.open(item.action.url,'_blank');
          break;
        case 'copy':
          navigator.clipboard.writeText(item.action.text).then(()=> showToast('L√§nk kopierad till urklipp.'));
          break;
        case 'quiz':
          window.open(item.action.url,'_blank');
          break;
        case 'download':
          if(item.action.url) window.open(item.action.url,'_blank');
          break;
        case 'call':
          alert(item.action.script || 'Ringt manus saknas.');
          break;
        case 'dm':
          showToast('√ñppna din meddelandeapp och skicka ett v√§nligt DM.');
          break;
        case 'video':
          showToast('√ñppna kampanjens video och l√§mna en kommentar.');
          break;
        case 'poll':
          showToast('Delta i en snabb enk√§t (l√§nk √∂ppnas).');
          break;
        case 'social_comment':
          showToast('√ñppna sociala kanalen och l√§mna en kommentar.');
          break;
        case 'ugc':
          showToast('Dela din korta anledning och tagga kampanjen.');
          break;
        case 'offline':
          showToast('Prata med en v√§n ‚Äî tack!');
          break;
        default:
          showToast('Aktivitet utf√∂rd ‚Äî tack!');
      }

    });
  </script>
</body>
</html>
